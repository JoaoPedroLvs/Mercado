$(function(){

    $('.page.page-admin.page-form').each(function() {
        var $self = $(this);

        var $switch = $self.find('.switch');

        var $switch = $self.find('.switch');

        var $label = $self.find('.label-switch');

        var $person = $self.find('.person')

        var $newPerson = $self.find('.new-person');

        var $inputs = $newPerson.find(':input');

        var $form = $self.find('form');

        var $select = $self.find('select').first();

        $switch.on('change', function() {

            if ($switch.is(':checked')) {

                $label.text('Nova pessoa');

                $person.addClass('d-none');

                $newPerson.removeClass('d-none');

                $inputs.attr({required:true});

                $select.attr({disabled: true});

                $inputs.removeAttr('disabled');

                $select.removeAttr('required');

                console.log($select);

                $form.attr({action: window.location.origin+'/person'});

            } else {

                $label.text('Pessoa já criada')

                $person.removeClass('d-none');

                $newPerson.addClass('d-none');

                $inputs.removeAttr('required');

                $inputs.attr({disabled:true});

                $select.removeAttr('disabled');

                $form.attr({action : window.location.origin+'/admin'});

            }

        });

    });

});

$(function(){

    var alertDelete = function($element) {

        var delay = 5000;

        setTimeout(function() {

            setTimeout(function() {

                $element.remove();

            }, 500);

        }, delay);
    }

    $('.alert-container').each(function() {

        alertDelete($(this));

    });


});

$(function () {

    $('.page-customer.page-form').each(function() {

        var $self = $(this);

        var $span = $self.find('.file-input');

        $('#image').on('change', function() {

            var $this = $(this);

            var file = $this.prop('files');

            if (file.length > 0) {

                var name = file[0].name;
                $span.text(name);

            } else {

                $span.text('Nenhum arquivo selecionado');
            }

        })

        var $switch = $self.find('.switch');

        var $switch = $self.find('.switch');

        var $label = $self.find('.label-switch');

        var $person = $self.find('.person')

        var $newPerson = $self.find('.new-person');

        var $inputs = $newPerson.find(':input');

        var $form = $self.find('form');

        var $select = $self.find('select').first();

        $switch.on('change', function() {

            if ($switch.is(':checked')) {

                $label.text('Nova pessoa');

                $person.addClass('d-none');

                $newPerson.removeClass('d-none');

                $inputs.attr({required:true});

                $select.attr({disabled: true});

                $inputs.removeAttr('disabled');

                $select.removeAttr('required');

                $form.attr({action: window.location.origin+'/person'});

            } else {

                $label.text('Pessoa já criada')

                $person.removeClass('d-none');

                $newPerson.addClass('d-none');

                $inputs.removeAttr('required');

                $inputs.attr({disabled:true});

                $select.removeAttr('disabled');

                $form.attr({action : window.location.origin+'/customer'});

            }

        });
    });
});

$(function(){

    $('.page.page-employee.page-form').each(function() {
        var $self = $(this);

        var $switch = $self.find('.switch');

        var $switch = $self.find('.switch');

        var $label = $self.find('.label-switch');

        var $person = $self.find('.person')

        var $newPerson = $self.find('.new-person');

        var $inputs = $newPerson.find(':input');

        var $form = $self.find('form');

        var $select = $self.find('select').first();

        $switch.on('change', function() {

            if ($switch.is(':checked')) {

                $label.text('Nova pessoa');

                $person.addClass('d-none');

                $newPerson.removeClass('d-none');

                $inputs.attr({required:true});

                $select.attr({disabled: true});

                $inputs.removeAttr('disabled');

                $select.removeAttr('required');

                $form.attr({action: window.location.origin+'/person'});

            } else {

                $label.text('Pessoa já criada')

                $person.removeClass('d-none');

                $newPerson.addClass('d-none');

                $inputs.removeAttr('required');

                $inputs.attr({disabled:true});

                $select.removeAttr('disabled');

                $form.attr({action : window.location.origin+'/admin'});

            }

        });

    });

});

$(function() {

    var $self = $(this);

    $('.modal.new-employee').each(function() {

        var $modal = $(this);

        $modal.modal({backdrop: 'static', keyboard: false});

        $modal.modal('show');

        $modal.on('click', '.btn.btn-save-employee', function() {

            $('form').trigger("submit");

            $modal.modal('hide');

        });
    });

    $('.dropdown, .dropdown-menu').on('mouseover', function() {

        var $this = $(this);

        $this.find('.dropdown-menu').show();

    }).on('mouseout', function() {

        $('.dropdown-menu').hide()
    });


    var searchParams = new URL(document.location).searchParams;


    var paramsOrder = searchParams.get('order');

    var paramsColumn = searchParams.get('column');

    $span = $self.find('.'+paramsColumn);


    if (paramsOrder == 'asc') {

        $span.eq(1).removeClass('d-none');

    } else if (paramsOrder == 'desc') {

        $span.eq(0).removeClass('d-none');

    } else {

        $span.eq(0).addClass('d-none');

        $span.eq(1).addClass('d-none');
    }

    $('.order').on('click', function () {

        var $this = $(this);

        console.log($this);

        var name = $this.data('field');
        var url = $this.data('url');
        var order = $this.data('order');

        url = url+'?column='+encodeURIComponent(name)+'&order='+encodeURIComponent(order);

        window.location.href = url;
    })

    $('.select-qty').on('change', function() {

        var $this = $(this);

        var qty = $this.find('option:selected').data('value');
        var url = $this.data('url');

        if (qty) {

            url = url+'?qtyPaginate='+encodeURIComponent(qty);

            window.location.href = url;
        }

    });

    // $('form').parsley();

    $('form').parsley({
        namespace: 'data-parsley-',
        inputs: 'input, textarea, select',

        excluded: 'input[type=button], input[type=submit], input[type=reset], input[type=hidden]',
        prorityEnabled: true,

        multiple: null,
        group: null,
        uiEnabled: true,

        validationThreshold: 3,
        focus: 'first',
        trigger: false,

        errorClass:'parsley-error',
        successClass: 'parsley-success',

        classHandler: function(Field) {},

        errosContainer: function (Field) {},

        errorsWrapper: '<div class="parsley-errors"></div>',
        errorTemplate: '<p style="color: red"></p>',

    });

});

$(function() {

    $('.page.page-form').each(function() {

        $self = $(this);

        $('.cpf').mask('000.000.000-00');

        $('.phone').mask('(00) 00000-0000');

        $('.work-code').mask('0000000/0000');

        $('.price').mask('# ##0,00', {reverse:true});

        $('.rg').mask('00000000000000');
    });
});

$(function() {

    $('.page.page-people.page-index').each(function() {

        var $self = $(this);

        var $delete = $self.find('.delete');

        $delete.on('click', function() {

            $this = $(this);

            bootbox.dialog({
                message: "Isso irá remover tudo relacionado à está pessoa?",
                title: "Deletar pessoa",
                onEscape: function() {},
                show: true,
                backdrop: "static",
                onEscape: false,
                closeButton: false,
                animate: true,
                className: "my-modal",
                buttons: {
                success: {
                    label: "Cancelar",
                    className: "btn-outline-primary",
                    callback: function() {}
                },
                delete: {
                    label: "Deletar",
                    className: "btn-outline-danger",
                    callback: function() {

                        window.location.replace(window.location.origin+'/'+$this.data('url'));

                    }
                }}
            });

        });

    });



});

$(function () {

    $('.page-product.page-form').each(function() {

        var $self = $(this);

        var $span = $self.find('.file-input');

        $('#image').on('change', function() {

            var $this = $(this);

            var file = $this.prop('files');

            if (file.length > 0) {

                var name = file[0].name;
                $span.text(name);

            } else {

                $span.text('Nenhum arquivo selecionado');
            }

        });

    });

    $('.page.page-products.page-cart').each(function() {

        var $self = $(this);

        var $sale = $self.find('.sale');

        $sale.on('click', function(e) {

            e.preventDefault();

            $self.find('.sale-form').trigger('submit');

        });

    });

});

$(function() {

    $('.page.page-sale.sale-form').each(function() {

        var $self = $(this)

        var $btnNewProduct = $self.find('.btn-new-product');

        var $select = $self.find('.select');

        $btnNewProduct.on('click', function() {

            var $btn = $(this);
            var $div = $btn.parent();
            var $products = $div.find('.products-itens');
            var $itens = $products.eq(0).clone().find("input").val("").end();
            $div.append($itens);

        });

        $self.on('click', '.btn-delete-product' , function() {

            var countItems = $self.find('.products-itens').length;

            if (countItems >= 2) {

                var $btn = $(this);
                var $div = $btn.parents('.products-itens');

                $div.remove();

            }

        });

    });
});

$(function(){

    $('.page.page-users.page-form').each(function() {
        var $self = $(this);

        var $switch = $self.find('.switch');

        $password = $self.find('.password');

        $switch.on('change', function() {

            if ($switch.is(':checked')) {

                $password.removeClass('d-none');
                $password.children('input').prop('required', true);

            } else {

                $password.addClass('d-none');
                $password.children('input').prop('required',false);
            }

        });

        $self.find('.checkbox').on('change', function() {

            var $checkbox = $(this);

            var $this = $(this);

            var type = $this.data('type');

            var $select = $this.parents('.row').find(`.${type}`);

            if ($checkbox.is(':checked')) {

                $select.removeClass('d-none');

            } else {

                $select.addClass('d-none');

            }
        })

    });

});
